<script setup lang="ts">
import { NuxtLink } from "#components";
import ContentChip from "~/components/content/chip.vue";

definePageMeta({
  layout: "default",
});

const { t } = useI18n();

// get the language as the key of locales "lang"
const lang = t("lang");

const route = useRoute();

const project = await queryCollection(`portfolio_${lang as "sk" | "en"}`)
  .where("slug", "=", route.params.slug)
  .first();

if (!project) {
  throw createError({ statusCode: 404, statusMessage: "Project not found" });
}

useHead({
  title: project.name,
  meta: [
    {
      name: "description",
      content: project.description,
    },
  ],
});

const icon = (status: "active" | "archived" | "planned") => {
  switch (status) {
    case "active":
      return "ph:seal-check-fill";
    case "archived":
      return "ph:seal-fill";
    case "planned":
      return "ph:seal-question-fill";
    default:
      return "ph:seal-fill";
  }
};
const getYearRange = (development: { start: string; end?: string }): string => {
  const startYear = development.start.split("-")[0];
  if (development.end) {
    const endYear = development.end.split("-")[0];
    if (startYear === endYear) {
      return startYear ?? "N/A";
    }
    return `${startYear} - ${endYear}`;
  }
  return `${startYear}+`;
};
</script>

<template>
  <div class="flex flex-col gap-8">
    <div
      class="xl:fixed bg-ebony max-xl:-mx-5 max-xl:-mt-50 text-peach top-0 left-0 xl:h-full xl:w-2/5 pl-5 xl:pl-25 pt-50 xl:pt-[40dvh] pb-12 flex flex-col justify-between items-start gap-32">
      <div class="flex flex-col">
        <h1 class="text-3xl font-bold mb-4">{{ project?.name }}</h1>
        <div class="flex flex-row gap-2">
          <ContentChip
            :icon="icon(project?.development?.status)"
            :title="getYearRange(project?.development)"
            accent />
          <ContentChip
            v-for="tag in project?.tags || []"
            :key="tag.content"
            :title="tag.content"
            :icon="tag.icon" />
        </div>
      </div>
      <div class="flex flex-row gap-8">
        <NuxtLink :to="$localePath('portfolio')" class="social-link-dark">
          <Icon name="ph:arrow-u-up-left" />
          {{ $t("portfolio.return") }}
        </NuxtLink>
        <a
          v-if="project?.link"
          class="social-link-dark"
          :href="project?.link"
          target="_blank"
          rel="noopener noreferrer">
          <Icon name="ph:browsers" />
          {{ $t("portfolio.visit") }}
        </a>
        <a
          v-if="project?.source"
          class="social-link-dark"
          :href="project?.source"
          target="_blank"
          rel="noopener noreferrer">
          <Icon name="ph:github-logo" />
          {{ $t("portfolio.source") }}
        </a>
      </div>
    </div>
    <ContentRenderer
      v-if="project"
      class="xl:col-start-2 xl:ml-[calc(40vw-(100vw-1300px)/2+3rem)] text-justify pb-12 content-renderer"
      :value="project" />
  </div>
</template>

<style scoped>
@reference "./../../assets/css/main.css";

:deep(a) {
  @apply text-ocean hover:text-ebony transition-colors duration-200;
}

:deep(.content-renderer) img {
  @apply rounded-lg;
}

:deep(.content-renderer) h1 > a,
:deep(.content-renderer) h2 > a,
:deep(.content-renderer) h3 > a,
:deep(.content-renderer) h4 > a,
:deep(.content-renderer) h5 > a,
:deep(.content-renderer) h6 > a {
  @apply no-underline text-ebony;
}

:deep(.content-renderer) p {
  @apply mb-4;
}

:deep(.content-renderer) ul {
  @apply list-disc list-inside pl-5 mb-4;
}

:deep(.content-renderer) code:not(pre) {
  @apply bg-ebony/15 py-0.5 px-2 rounded-lg font-family-mono;
}

:deep(.content-renderer) pre {
  @apply bg-ebony/15 p-4 rounded-lg overflow-x-auto mb-4;
}
</style>
